<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>The most beautiful you</title>
		<link rel="stylesheet" href="css/index.css" />
	</head>
	<body>
		<!--/*外层最大容器*/-->
		<div class="wrap">
	<!--	/*包裹所有元素的容器*/-->
		<div class="cube">
			<!--前面图片 -->
			<div class="out_front">
				<img src="img/1.jpg"  class="pic"/>
			</div>
			<!--后面图片 -->
			<div class="out_back">
				<img src="img/2.jpg"  class="pic"/>
			</div>
			<!--左图片 -->
			<div class="out_left">
				<img src="img/3.jpg"  class="pic"/>
			</div>
			<div class="out_right">
				<img src="img/4.jpg"  class="pic"/>
			</div>
			<div class="out_top">
				<img src="img/5.jpg"  class="pic"/>
			</div>
			<div class="out_bottom">
				<img src="img/6.jpg"  class="pic"/>
			</div>
			<!--小正方体 -->
			<span class="in_front">
				<img src="img/7.jpg" class="in_pic" />
			</span>
			<span class="in_back">
			     <img src="img/8.jpg" class="in_pic" />
			</span>
			<span class="in_left">
				<img src="img/9.jpg" class="in_pic" />
			</span>
			<span class="in_right">
				<img src="img/10.jpg" class="in_pic" />
			</span>
			<span class="in_top">
				<img src="img/11.jpg" class="in_pic" />
			</span>
			<span class="in_bottom">
				<img src="img/12.jpg" class="in_pic" />
			</span>
		</div>
		</div>
	</body>
	<script>
		// 为了防止第二次创建
		let playState= true
		function testAutoPlay () {
    // 返回一个promise以告诉调用者检测结果
        return new Promise(resolve => {
		if(playState){
			        let audio = document.createElement('audio');
        audio.src="css/冯提莫-世间美好与你环环相扣.mp3"
        //循环播放，如果不需要可注释
		audio.loop="loop"
        document.body.appendChild(audio);
        let autoplay = true;
        // play返回的是一个promise
        audio.play().then(() => {
            // 支持自动播放
            autoplay = true;
			console.log("正常播放")
        }).catch(err => {
            // 不支持自动播放
			console.log("不支持播放")
            autoplay = false;
        }).finally((e) => {
            resolve(autoplay);
        });
		playState=false
		}else{
			resolve(false)
		}

    });
}

let audioInfo = {
    autoplay: false,
    testAutoPlay () {
        return testAutoPlay()
    },
    // 监听页面的点击事件，一旦点过了就能autoplay了
    setAutoPlayWhenClick () {
        function setAutoPlay () {
            // 设置自动播放为true
            audioInfo.autoplay = true;
            document.removeEventListener('click', setAutoPlay);
            document.removeEventListener('touchend', setAutoPlay);
        }
        document.addEventListener('click', setAutoPlay);
        document.addEventListener('touchend', setAutoPlay);
    },
    init () {
        // 检测是否能自动播放
        audioInfo.testAutoPlay().then(autoplay => {
            if (!audioInfo.autoplay) {
                audioInfo.autoplay = autoplay;
            }
        });
        // 用户点击交互之后，设置成能自动播放
        audioInfo.setAutoPlayWhenClick();
    }
};
        // PC端
        document.addEventListener('click', ()=>{
	    audioInfo.init();
        });
        // 移动端
         document.addEventListener('touchend', ()=>{
	      audioInfo.init();
         });
	</script>
</html>
